<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->

<html>
  <head>
  	<meta charset="utf-8">
	<title>Finance</title>
	<link rel="stylesheet" href="js/jquery/themes/base/jquery.ui.all.css">
	<script src="js/jquery/jquery-1.9.1.js"></script>
		<script src="js/jquery/ui/jquery.ui.core.js"></script>
		<script src="js/jquery/ui/jquery.ui.widget.js"></script>
		<script src="js/jquery/ui/jquery.ui.mouse.js"></script>
		<script src="js/jquery/ui/jquery.ui.datepicker.js"></script>
		<script src="js/jquery/ui/jquery.ui.draggable.js"></script>
		<script src="js/jquery/ui/jquery.ui.position.js"></script>
		<script src="js/jquery/ui/jquery.ui.resizable.js"></script>
		<script src="js/jquery/ui/jquery.ui.button.js"></script>
		<script src="js/jquery/ui/jquery.ui.dialog.js"></script>
		<script src="js/jquery/ui/jquery.ui.effect.js"></script>
		<script type="text/javascript" src="js/financemodule.js"></script>
	<style>
		.validateTips { border: 1px solid transparent; padding: 0.3em; }
	</style>
	<script type="text/javascript">
	$(document).ready(function(){
	  
	  $("#btnAdd").click(function(){
	  	$("#dlgFinanceInfo").dialog("open");
	  });
	  $("#btnModify").click(function(){
	  
	  });
	  $("#btnDelete").click(function(){
	  
	  });
	  $("#btnQuery").click(function(){
	  	loadFinanceData();
	  });
	  
	});
	function loadFinanceData()
	{
		$.post("/agent/finance.query",
	    {
	      name:"Donald Duck",
	      city:"Duckburg"
	    },
	    function(data,status)
	    {
	    	if (data.charAt(0) != '\"')
	    	{
	    		alert(data);
	    		return;
	    	}
	    	//var aryRecord = eval(data);
	    	var aryRecord = data.evalJSON(true);
	    	for (index = 0, size = aryRecord.length;index < size; ++index)
	    	{
	    		var record = aryRecord[index];
	    		var rowData = "<tr><td>" + record.date + "</td><td>"
	    			+ record.wares + "</td></tr>";
	    		$("#tblFinance").append(rowData);
	    	}
	 
	    });
	    function appendRecord2Table(record)
	    {
	    }
	}
	</script>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Finance</title>
  </head>

  <body>
    <h1>Finance</h1>
	<button id="btnAdd">Add</button>
	<button id="btnModify">Modify</button>
	<button id="btnDelete">Delete</button>
	<button id="btnQuery">Query</button>
	<div id="txtStatus">Loading...</div>
    <table id="tblFinance" border="1">
    	<tr>
    		<th>Consume Date</th>
    		<th>Wares Name</th>
    		<th>Price</th>
    		<th>Amount</th>
    		<th>Unit</th>
    		<th>Deadline</th>
    		<th>Kind</th>
    		<th>Record Time</th>
    		<th>Remark</th>
    	</tr>
    </table>
    
    <div id="dlgFinanceInfo" title="Add Finance Record">Finance Information<hr>
    	Consume Date:<input type="text" id="addDlgConsumeDate"/><br>
    	Wares Name:<input type="text" id="addDlgWareName"/><br>
    	Price:<input type="text" id="addDlgPrice"/>Yuan<br>
    	Amount:<input type="text" id="addDlgAmount"/><br>
    	Unit:<input type="text" id="addDlgUnit"/><br>
    	Deadline:<input type="text" id="addDlgDeadline"/>Days<br>
    	Kind:<input type="text" id="addDlgKind"/><br>
    	Remark:<input type="text" id="addDlgRemark"/>
    	<p class="validateTips">All form fields are required.</p>
    </div>
    <script>
    
    $("#dlgFinanceInfo").dialog({
	  autoOpen: false,
	  width:400,
	  dialogClass: "no-close",
	  buttons: [
	    {
	      text: "OK",
	      click: function(){$(this).btnOK();}
	    }]});
	  addDlg.btnOK=function()
	   {
       	//collect all information
       	var info = {
       		consumeTime:$("#addDlgConsumeDate").val(),
       		waresName:$("#addDlgWareName").val()
       		};
       	info.price=$("#addDlgPrice").val();
       	info.unit=$("#addDlgUnit").val();
       	info.deadline=$("#addDlgDeadline").val();
       	info.kind=$("#addDlgKind").val();
       	info.remark=$("#addDlgRemark").val();
       	
       	//send information to the server
       	$.post("/agent/finance.add", info, msgReceved);
    	},
    	addDlg.msgReceved=function(data, status)
	    {
	    	if (data.charAt(0) != '\"')
	    	{
	    		updateTip(data);
	    		return;
	    	}
	    	
	    	//if the server save it success the show this record in table
	    	var record = data.evalJSON(true);
	    	appendRecord2Table(record);
	        $( this ).dialog( "close" );
	    },
	    addDlg.tips=$("#validateTips"),
	    
	    addDlg.updateTip=function(msg)
	    {
	    	tips.text( t )
				.addClass( "ui-state-highlight" );
			setTimeout(function() {
				tips.removeClass( "ui-state-highlight", 1500 );
			}, 500 );
	    }
	  });
	  $("#addDlgConsumeDate").datepicker({dateFormat: "yy-mm-dd"});
	  </script>
  </body>
</html>